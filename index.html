<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Unit Factory — Excel → Minecraft JSON Generator</title>
  <style>
    :root {
      --bg:#0b1020; --panel:#121a2e; --panel2:#0f162b; --text:#eaf0ff; --muted:#aab6d6;
      --line:rgba(255,255,255,.12); --accent:#79a6ff; --danger:#ff6b6b; --ok:#33d08a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    body {
      margin:0; font-family:var(--sans); color:var(--text);
      background: radial-gradient(1200px 800px at 10% 0%, #1a2a55 0%, var(--bg) 55%);
    }
    header {
      position:sticky; top:0; z-index:10;
      padding:16px 18px 12px; border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.20); backdrop-filter: blur(10px);
    }
    header h1 { margin:0 0 6px; font-size:18px; font-weight:800; letter-spacing:.2px; }
    header p { margin:0; color:var(--muted); font-size:13px; line-height:1.4; }
    .wrap { max-width:1200px; margin:0 auto; padding:18px; }
    .grid { display:grid; grid-template-columns: 1.1fr .9fr; gap:14px; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
    .card {
      border:1px solid var(--line); border-radius:16px; padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .card h2 { margin:0 0 10px; font-size:14px; font-weight:800; display:flex; justify-content:space-between; gap:10px; }
    .hint { color:var(--muted); font-weight:600; font-size:12px; }
    label { display:block; margin:10px 0 6px; color:var(--muted); font-size:12px; }
    input[type=file] { width:100%; color:var(--muted); font-size:12px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button {
      border:1px solid var(--line); background: rgba(121,166,255,.12); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:800;
    }
    button:hover { border-color: rgba(121,166,255,.55); }
    button.primary { background: rgba(121,166,255,.20); border-color: rgba(121,166,255,.45); }
    button.danger { background: rgba(255,107,107,.16); border-color: rgba(255,107,107,.40); }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .pill {
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid var(--line); background: rgba(0,0,0,.20);
      padding:6px 10px; border-radius:999px; font-size:11px; font-family:var(--mono);
    }
    .dot { width:8px; height:8px; border-radius:50%; background:var(--muted); }
    .dot.ok { background: var(--ok); }
    .dot.bad { background: var(--danger); }
    table {
      width:100%; border-collapse:separate; border-spacing:0;
      overflow:hidden; border-radius:14px; border:1px solid var(--line);
      background: rgba(0,0,0,.18);
    }
    th, td { padding:10px 10px; font-size:12px; border-bottom:1px solid var(--line); vertical-align:top; }
    th { text-align:left; color:var(--muted); font-weight:800; background: rgba(0,0,0,.16); position:sticky; top:0; }
    tr:last-child td { border-bottom:none; }
    code { font-family:var(--mono); font-size:11px; }
    .small { color:var(--muted); font-size:12px; line-height:1.45; }
    .scroll { max-height: 520px; overflow:auto; border-radius:14px; border:1px solid var(--line); }
    pre {
      margin:0; padding:12px; border-radius:14px; border:1px solid var(--line);
      background: rgba(0,0,0,.25); color: var(--text);
      font-family: var(--mono); font-size:11px; line-height:1.4; overflow:auto; max-height:520px;
    }
    .kpi { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
  </style>
</head>
<body>
<header>
  <h1>Unit Factory — Excel → Minecraft JSON Generator</h1>
  <p>Upload your Excel sheet, review the unit summary, then generate a ZIP with <code>behaviors/</code>, <code>entity_resource/</code>, and <code>spawn_rules/</code> folders — ready to paste into your add-on.</p>
</header>

<div class="wrap">
  <div class="grid">
    <section class="card">
      <h2>1) Inputs <span class="hint">Excel + (optional) template overrides</span></h2>

      <label>Unit Factory Sheet (.xlsx)</label>
      <input id="excelFile" type="file" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/>

      <label>Templates.zip (optional override)</label>
      <input id="zipFile" type="file" accept=".zip,application/zip"/>
      <div class="small">
        If you do not upload a templates ZIP, the generator uses the embedded defaults.
        Your ZIP should contain folders for each category (soldier, archer, cavalry, horse_archer, crossbow, elephant, gunner, citizen),
        each with one <code>*.behavior.json</code> and one <code>*.entity.json</code>, plus <code>spawn_rule.json</code>.
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="parseBtn" class="primary" disabled>Parse Excel</button>
        <button id="generateBtn" class="primary" disabled>Generate ZIP</button>
        <button id="clearBtn" class="danger">Clear</button>
      </div>

      <div class="kpi">
        <span class="pill"><span id="dotParsed" class="dot"></span> <span id="txtParsed">No sheet loaded</span></span>
        <span class="pill">units: <span id="kpiUnits">0</span></span>
        <span class="pill">errors: <span id="kpiErrors">0</span></span>
      </div>

      <div class="small" style="margin-top:12px;">
        <b>Spawn egg color note:</b> this tool reads the <i>cell fill</i> color (highlight) from the Excel columns
        <code>Spawn Egg - Base Color</code> and <code>Spawn Egg - Overlay Color</code>. If a fill color is missing,
        you can also type a hex like <code>#ff00aa</code> into the cell as a fallback.
      </div>

      <div class="small" style="margin-top:10px;">
        Built to match your Unit Factory spec (categories, columns, folder layout, and naming convention).
      </div>
    </section>

    <section class="card">
      <h2>2) Summary <span class="hint">what will be generated</span></h2>
      <div id="summaryWrap" class="scroll">
        <table id="summaryTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Category</th>
              <th>Identifier</th>
              <th>Family (primary)</th>
              <th>HP</th>
              <th>DMG</th>
              <th>Targets (family/tag)</th>
              <th>Biome Tag</th>
              <th>Errors</th>
            </tr>
          </thead>
          <tbody id="summaryBody">
            <tr><td colspan="9" class="small">Upload and parse an Excel file to see a summary.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <section class="card" style="margin-top:14px;">
    <h2>Preview <span class="hint">selected unit output</span></h2>
    <div class="row">
      <label style="margin:0;">Preview row #</label>
      <input id="previewIndex" type="number" min="1" value="1" style="width:100px; padding:10px; border-radius:12px; border:1px solid var(--line); background:rgba(0,0,0,.25); color:var(--text);"/>
      <button id="previewBtn">Show Preview</button>
      <span class="small">Shows behavior + client entity + spawn rule JSON for that row.</span>
    </div>
    <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; margin-top:10px;">
      <div><div class="small" style="margin:0 0 6px;"><b>Behavior</b></div><pre id="preBeh">—</pre></div>
      <div><div class="small" style="margin:0 0 6px;"><b>Client Entity</b></div><pre id="preEnt">—</pre></div>
      <div><div class="small" style="margin:0 0 6px;"><b>Spawn Rule</b></div><pre id="preSpawn">—</pre></div>
    </div>
  </section>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>

<script>
  // Embedded default templates (raw text, including possible //bridge comments)
  const DEFAULT_TEMPLATES_TEXT = {"soldier": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:egyptian_mamluk\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 8\r\n                },\r\n\"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"islam\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 54,\r\n                \"max\": 54\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.25\r\n},\r\n\"minecraft:attack\": {\r\n                    \"damage\": 10\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n},\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 4,\r\n\t\t\t\t\t\"track_target\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"bread\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"islam\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"islam\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"has_tag\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                                \"must_see\": true,\r\n                \"must_reach\": false\r\n\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:egyptian_mamluk\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/egyptian_mamluk\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.egyptian_mamluk\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.sword_run\",\r\n\t\t\t\t\"idle\": \"animation.sword_idle\",\r\n\t\t\t\t\"attack\": \"animation.sword_attack\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\",\r\n\t\t\t\t\"attacking\": \"controller.animation.soldier.attacking\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"attacking\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#d5c258\",\r\n\t\t\t\t\"overlay_color\": \"#f2971c\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "archer": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:egyptian_archer\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n                \"minecraft:target_nearby_sensor\": {\r\n                    \"inside_range\": 3,\r\n                    \"outside_range\": 4,\r\n                    \"must_see\": true,\r\n                    \"on_inside_range\": {\r\n                        \"event\": \"switch_to_melee\",\r\n                        \"target\": \"self\"\r\n                    },\r\n                    \"on_outside_range\": {\r\n                        \"event\": \"switch_to_ranged\",\r\n                        \"target\": \"self\"\r\n                    }\r\n                }\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:shooter\": {\r\n                    \"def\": \"myname:arrow2\"\r\n                },\r\n                \"minecraft:behavior.ranged_attack\": {\r\n                    \"priority\": 3,\r\n                    \"attack_interval_min\": 1.75,\r\n                    \"attack_interval_max\": 1.75,\r\n                    \"burst_shots\": 1,\r\n                    \"speed_multiplier\": 0.8,\r\n                    \"attack_radius\": 40\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 5\r\n                },\r\n                \"minecraft:behavior.delayed_attack\": {\r\n                    \"priority\": 4,\r\n                    \"attack_once\": false,\r\n                    \"track_target\": true,\r\n                    \"require_complete_path\": false,\r\n                    \"random_stop_interval\": 0,\r\n                    \"reach_multiplier\": 1.5,\r\n                    \"speed_multiplier\": 1,\r\n                    \"attack_duration\": 0.75,\r\n                    \"hit_delay_pct\": 0.5\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"islam\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 34,\r\n                \"max\": 34\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.25\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"bread\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"islam\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"islam\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"has_tag\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                \"must_see\": true\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"bad\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"monster\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:egyptian_archer\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/egyptian_archer\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.egyptian_archer\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.archer_walk\",\r\n\t\t\t\t\"idle\": \"animation.archer_idle\",\r\n\t\t\t\t\"shoot\": \"animation.horse_archer_shoot\",\r\n\t\t\t\t\"look_at_target\": \"animation.humanoid.look_at_target.default\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#d5c258\",\r\n\t\t\t\t\"overlay_color\": \"#f2971c\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "cavalry": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:egyptian_cavalry\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 8\r\n                },\r\n\"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"islam\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 58,\r\n                \"max\": 58\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.50\r\n},\r\n\"minecraft:attack\": {\r\n                    \"damage\": 12\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n},\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"bread\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"islam\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"islam\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"has_tag\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                                \"must_see\": true,\r\n                \"must_reach\": false\r\n\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:egyptian_cavalry\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/egyptian_cavalry\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.egyptian_cavalry\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.heavy_cavalry_run\",\r\n\t\t\t\t\"idle\": \"animation.heavy_cavalry_idle\",\r\n\t\t\t\t\"attack\": \"animation.sword_attack\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\",\r\n\t\t\t\t\"attacking\": \"controller.animation.soldier.attacking\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"attacking\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#d5c258\",\r\n\t\t\t\t\"overlay_color\": \"#f2971c\" \r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "horse_archer": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:egyptian_horse_archer\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n                \"minecraft:target_nearby_sensor\": {\r\n                    \"inside_range\": 3,\r\n                    \"outside_range\": 4,\r\n                    \"must_see\": true,\r\n                    \"on_inside_range\": {\r\n                        \"event\": \"switch_to_melee\",\r\n                        \"target\": \"self\"\r\n                    },\r\n                    \"on_outside_range\": {\r\n                        \"event\": \"switch_to_ranged\",\r\n                        \"target\": \"self\"\r\n                    }\r\n                }\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:shooter\": {\r\n                    \"def\": \"myname:arrow2\"\r\n                },\r\n                \"minecraft:behavior.ranged_attack\": {\r\n                    \"priority\": 3,\r\n                    \"attack_interval_min\": 1.75,\r\n                    \"attack_interval_max\": 1.75,\r\n                    \"burst_shots\": 3,\r\n                    \"speed_multiplier\": 0.8,\r\n                    \"attack_radius\": 40\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 5\r\n                },\r\n                \"minecraft:behavior.delayed_attack\": {\r\n                    \"priority\": 4,\r\n                    \"attack_once\": false,\r\n                    \"track_target\": true,\r\n                    \"require_complete_path\": false,\r\n                    \"random_stop_interval\": 0,\r\n                    \"reach_multiplier\": 1.5,\r\n                    \"speed_multiplier\": 1,\r\n                    \"attack_duration\": 0.75,\r\n                    \"hit_delay_pct\": 0.5\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"islam\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 54,\r\n                \"max\": 54\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.5\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"bread\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"islam\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"islam\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"has_tag\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"crusader\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                \"must_see\": true\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"bad\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"monster\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:egyptian_horse_archer\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/egyptian_horse_archer\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.egyptian_horse_archer\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.horse_archer_run\",\r\n\t\t\t\t\"idle\": \"animation.horse_archer_idle\",\r\n\t\t\t\t\"shoot\": \"animation.horse_archer_shoot\",\r\n\t\t\t\t\"look_at_target\": \"animation.humanoid.look_at_target.default\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#d5c258\",\r\n\t\t\t\t\"overlay_color\": \"#f2971c\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "crossbow": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:chinese_crossbowman\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n                \"minecraft:target_nearby_sensor\": {\r\n                    \"inside_range\": 3,\r\n                    \"outside_range\": 4,\r\n                    \"must_see\": true,\r\n                    \"on_inside_range\": {\r\n                        \"event\": \"switch_to_melee\",\r\n                        \"target\": \"self\"\r\n                    },\r\n                    \"on_outside_range\": {\r\n                        \"event\": \"switch_to_ranged\",\r\n                        \"target\": \"self\"\r\n                    }\r\n                }\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:shooter\": {\r\n                    \"def\": \"myname:heavy_arrow\"\r\n                },\r\n                \"minecraft:behavior.ranged_attack\": {\r\n                    \"priority\": 3,\r\n                    \"attack_interval_min\": 3,\r\n                    \"attack_interval_max\": 3,\r\n                    \"burst_shots\": 1,\r\n                    \"speed_multiplier\": 0.8,\r\n                    \"attack_radius\": 40\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 5\r\n                },\r\n                \"minecraft:behavior.delayed_attack\": {\r\n                    \"priority\": 4,\r\n                    \"attack_once\": false,\r\n                    \"track_target\": true,\r\n                    \"require_complete_path\": false,\r\n                    \"random_stop_interval\": 0,\r\n                    \"reach_multiplier\": 1.5,\r\n                    \"speed_multiplier\": 1,\r\n                    \"attack_duration\": 0.75,\r\n                    \"hit_delay_pct\": 0.5\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"chinese\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 24,\r\n                \"max\": 24\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.25\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"myname:rice\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"chinese\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"chinese\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                \"must_see\": true\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"bad\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"monster\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:chinese_crossbowman\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/chinese_crossbowman\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.chinese_crossbowman\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.crossbow_walk\",\r\n\t\t\t\t\"idle\": \"animation.crossbow_idle\",\r\n\t\t\t\t\"shoot\": \"animation.crossbow_shoot\",\r\n\t\t\t\t\"look_at_target\": \"animation.humanoid.look_at_target.default\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#505050\",\r\n\t\t\t\t\"overlay_color\": \"#ff1919\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "elephant": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:delhi_war_elephant\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 8\r\n                },\r\n\"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"delhi\",\r\n                    \"mob\",\r\n                    \"bad\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 200,\r\n                \"max\": 200\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.30\r\n},\r\n\"minecraft:attack\": {\r\n                    \"damage\": 34\r\n},\r\n\"minecraft:scale\": {\r\n\t\t\t\t\"value\": 2.5\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 1\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n},\r\n                \"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\t\"speed_multiplier\": 1.1,\r\n\t\t\t\t\t\"reach_multiplier\": 2.5,\r\n\t\t\t\t\t\"track_target\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"bread\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"delhi\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"delhi\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"mongol\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n{\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"player\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"good\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                                \"must_see\": true,\r\n                \"must_reach\": false\r\n\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"none\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:delhi_war_elephant\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/delhi_war_elephant\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.delhi_war_elephant\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.elephant_walk\",\r\n\t\t\t\t\"idle\": \"animation.elephant_idle\",\r\n\t\t\t\t\"attack\": \"animation.elephant_attack\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\",\r\n\t\t\t\t\"attacking\": \"controller.animation.soldier.attacking\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"attacking\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#265d13\",\r\n\t\t\t\t\"overlay_color\": \"#ff9e00\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "gunner": {"behavior": "{\r\n    \"format_version\": \"1.16.0\",\r\n    \"minecraft:entity\": {\r\n        \"description\": {\r\n            \"identifier\": \"myname:chinese_fire_lance\",\r\n            \"is_spawnable\": true,\r\n            \"is_summonable\": true,\r\n            \"is_experimental\": false\r\n        },\r\n        \"component_groups\": {\r\n            \"x:x\": {\r\n                \"minecraft:transformation\": {\r\n                    \"into\": \"x:x\"\r\n                }\r\n            },\r\n            \"mode_switcher\": {\r\n                \"minecraft:target_nearby_sensor\": {\r\n                    \"inside_range\": 3,\r\n                    \"outside_range\": 4,\r\n                    \"must_see\": true,\r\n                    \"on_inside_range\": {\r\n                        \"event\": \"switch_to_melee\",\r\n                        \"target\": \"self\"\r\n                    },\r\n                    \"on_outside_range\": {\r\n                        \"event\": \"switch_to_ranged\",\r\n                        \"target\": \"self\"\r\n                    }\r\n                }\r\n            },\r\n            \"ranged_mode\": {\r\n                \"minecraft:shooter\": {\r\n                    \"def\": \"dungeon:bullet\"\r\n                },\r\n                \"minecraft:behavior.ranged_attack\": {\r\n                    \"priority\": 3,\r\n                    \"attack_interval_min\": 15,\r\n                    \"attack_interval_max\": 15,\r\n                    \"burst_shots\": 2,\r\n                    \"speed_multiplier\": 0.8,\r\n                    \"attack_radius\": 20\r\n                }\r\n            },\r\n            \"melee_mode\": {\r\n                \"minecraft:attack\": {\r\n                    \"damage\": 5\r\n                },\r\n                \"minecraft:behavior.delayed_attack\": {\r\n                    \"priority\": 4,\r\n                    \"attack_once\": false,\r\n                    \"track_target\": true,\r\n                    \"require_complete_path\": false,\r\n                    \"random_stop_interval\": 0,\r\n                    \"reach_multiplier\": 1.5,\r\n                    \"speed_multiplier\": 1,\r\n                    \"attack_duration\": 0.75,\r\n                    \"hit_delay_pct\": 0.5\r\n                }\r\n            }\r\n        },\r\n        \"components\": {\r\n            \"minecraft:collision_box\": {\r\n                \"height\": 1.9,\r\n                \"width\": 0.6\r\n            },\r\n            \"minecraft:type_family\": {\r\n                \"family\": [\r\n                    \"chinese\",\r\n                    \"mob\",\r\n                    \"good\"\r\n                ]\r\n            },\r\n            \"minecraft:breathable\": {\r\n                \"totalSupply\": 15,\r\n                \"suffocateTime\": 0\r\n            },\r\n            \"minecraft:health\": {\r\n                \"value\": 24,\r\n                \"max\": 24\r\n            },\r\n            \"minecraft:loot\": {\r\n                \"table\": \"loot_tables/entities/survivor_rifleman.json\"\r\n            },\r\n            \"minecraft:movement\": {\r\n                \"value\": 0.25\r\n            },\r\n            \"minecraft:knockback_resistance\": {\r\n                \"value\": 0\r\n            },\r\n            \"minecraft:sittable\": {},\r\n            \"minecraft:behavior.stay_while_sitting\": {\r\n                \"priority\": 3\r\n            },\r\n            \"minecraft:navigation.walk\": {\r\n                \"is_amphibious\": true,\r\n                \"can_pass_doors\": true,\r\n                \"can_open_doors\": true,\r\n                \"avoid_water\": true\r\n            },\r\n            \"minecraft:movement.basic\": {},\r\n            \"minecraft:jump.static\": {},\r\n            \"minecraft:can_climb\": {},\r\n            \"minecraft:nameable\": {},\r\n            \"minecraft:healable\": {\r\n                \"items\": [\r\n                    {\r\n                        \"item\": \"myname:rice\",\r\n                        \"heal_amount\": 5\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:despawn\": {\r\n                \"despawn_from_distance\": {}\r\n            },\r\n            \"minecraft:behavior.float\": {\r\n                \"priority\": 0\r\n            },\r\n            \"minecraft:damage_sensor\": {\r\n                \"triggers\": [\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"test\": \"is_family\",\r\n                                \"subject\": \"other\",\r\n                                \"value\": \"chinese\"\r\n                            }\r\n                        },\r\n                        \"deals_damage\": false\r\n                    },\r\n                    {\r\n                        \"on_damage\": {\r\n                            \"filters\": {\r\n                                \"any_of\": [\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    },\r\n                                    {\r\n                                        \"test\": \"is_family\",\r\n                                        \"subject\": \"other\",\r\n                                        \"value\": \"x\"\r\n                                    }\r\n                                ],\r\n                                \"all_of\": [\r\n                                    {\r\n                                        \"test\": \"has_damage\",\r\n                                        \"value\": \"fatal\"\r\n                                    }\r\n                                ]\r\n                            },\r\n                            \"event\": \"x:x\"\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"chinese\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.nearest_attackable_target\": {\r\n                \"priority\": 2,\r\n                \"within_radius\": 64,\r\n                \"reselect_targets\": true,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"monster\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    },\r\n                    {\r\n                        \"filters\": {\r\n                            \"test\": \"is_family\",\r\n                            \"subject\": \"other\",\r\n                            \"value\": \"bad\"\r\n                        },\r\n                        \"max_dist\": 64\r\n                    }\r\n                ],\r\n                \"must_see\": true\r\n            },\r\n            \"minecraft:behavior.look_at_player\": {\r\n                \"priority\": 7,\r\n                \"look_distance\": 8\r\n            },\r\n            \"minecraft:behavior.random_look_around\": {\r\n                \"priority\": 7\r\n            },\r\n            \"minecraft:follow_range\": {\r\n                \"value\": 64\r\n            },\r\n            \"minecraft:behavior.avoid_mob_type\": {\r\n                \"priority\": 3,\r\n                \"entity_types\": [\r\n                    {\r\n                        \"filters\": {\r\n                            \"any_of\": [\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"bad\"\r\n                                },\r\n                                {\r\n                                    \"test\": \"is_family\",\r\n                                    \"subject\": \"other\",\r\n                                    \"value\": \"monster\"\r\n                                }\r\n                            ]\r\n                        },\r\n                        \"max_dist\": 6,\r\n                        \"walk_speed_multiplier\": 1,\r\n                        \"sprint_speed_multiplier\": 1\r\n                    }\r\n                ]\r\n            },\r\n            \"minecraft:behavior.owner_hurt_by_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:behavior.owner_hurt_target\": {\r\n                \"priority\": 1,\r\n                \"entity_types\": {\r\n                    \"filters\": {\r\n                        \"test\": \"is_family\",\r\n                        \"subject\": \"other\",\r\n                        \"operator\": \"!=\",\r\n                        \"value\": \"survivor\"\r\n                    },\r\n                    \"max_dist\": 64\r\n                }\r\n            },\r\n            \"minecraft:tameable\": {\r\n                \"probability\": 0.99,\r\n                \"tameItems\": [\r\n                    \"myname:90_coin\"\r\n                ],\r\n                \"tame_event\": {\r\n                    \"event\": \"minecraft:on_tame\",\r\n                    \"target\": \"self\"\r\n                }\r\n            },\r\n            \"minecraft:behavior.follow_owner\": {\r\n                \"start_distance\": 10,\r\n                \"speed_multiplier\": 1,\r\n                \"stop_distance\": 2,\r\n                \"priority\": 6\r\n            },\r\n            \"minecraft:annotation.open_door\": {},\r\n            \"minecraft:behavior.open_door\": {\r\n                \"priority\": 5,\r\n                \"close_door_after\": true\r\n            },\r\n            \"minecraft:physics\": {},\r\n            \"minecraft:pushable\": {\r\n                \"is_pushable\": true,\r\n                \"is_pushable_by_piston\": true\r\n            },\r\n            \"minecraft:equipment\": {\r\n                \"table\": \"loot_tables/empty.json\"\r\n            }\r\n        },\r\n        \"events\": {\r\n            \"x:x\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"x:x\"\r\n                    ]\r\n                }\r\n            },\r\n            \"minecraft:entity_spawned\": {\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"mode_switcher\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_melee\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                }\r\n            },\r\n            \"switch_to_ranged\": {\r\n                \"remove\": {\r\n                    \"component_groups\": [\r\n                        \"melee_mode\"\r\n                    ]\r\n                },\r\n                \"add\": {\r\n                    \"component_groups\": [\r\n                        \"ranged_mode\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:chinese_fire_lance\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/chinese_fire_lance\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.chinese_fire_lance\"\r\n            },\r\n      \"particle_effects\": {\r\n        \"steam\": \"dungeon:steam\",\r\n        \"steam2\": \"dungeon:steam2\",\r\n        \"flamethrower\": \"dungeon:flamethrower\"\r\n       },\r\n       \"sound_effects\": {\r\n    \"boom1\": \"musket\",\r\n    \"asia_mech\": \"asia_mech\",\r\n\"laser_beam\": \"laser_beam\",\r\n\"silo_open\": \"silo_open\",\r\n\"asia_mech_step\": \"asia_mech_step\",\r\n    \"thunder\": \"thunder1\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.firelance_walk\",\r\n\t\t\t\t\"idle\": \"animation.firelance_idle\",\r\n\t\t\t\t\"shoot\": \"animation.firelance_shoot\",\r\n\t\t\t\t\"look_at_target\": \"animation.humanoid.look_at_target.default\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#a61212\",\r\n\t\t\t\t\"overlay_color\": \"#eef882\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}, "citizen": {"behavior": "//bridge-file-version: #0\r\n{\r\n\t\"format_version\": \"1.13.0\",\r\n\t\"minecraft:entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:korean_man\",\r\n\t\t\t\"is_spawnable\": true,\r\n\t\t\t\"is_summonable\": true,\r\n\t\t\t\"is_experimental\": false\r\n\t\t},\r\n\t\t\"components\": {\r\n\t\t\t\"minecraft:experience_reward\": {\r\n\t\t\t\t\"on_death\": \"query.last_hit_by_player ? 5 + (query.equipment_count * Math.Random(1,3)) : 0\"\r\n\t\t\t},\r\n\t\t\t\"minecraft:nameable\": {},\r\n\t\t\t\"minecraft:breathable\": {\r\n\t\t\t\t\"total_supply\": 15,\r\n\t\t\t\t\"suffocate_time\": 0,\r\n\t\t\t\t\"breathes_water\": true\r\n\t\t\t},\r\n\t\t\t\"minecraft:health\": {\r\n\t\t\t\t\"value\": 20,\r\n\t\t\t\t\"max\": 20\r\n\r\n\t\t\t},\r\n\t\t\t\"minecraft:collision_box\": {\r\n\t\t\t\t\"width\": 0.72,\r\n\t\t\t\t\"height\": 2.01\r\n\t\t\t},\r\n\t\t\t\"minecraft:attack\": {\r\n\t\t\t\t\"damage\": 1\r\n\t\t\t},\r\n\t\t\t\"minecraft:loot\": {\r\n\t\t\t\t\"table\": \"loot_tables/entities/citizen.json\"\r\n\t\t\t},\r\n\t\t\t\"minecraft:equipment\": {\r\n\t\t\t\t\"table\": \"loot_tables/entities/empty.json\"\r\n\t\t\t},\r\n\t\t\t\"minecraft:movement\": {\r\n\t\t\t\t\"value\": 0.25\r\n\t\t\t},\r\n\t\t\t\"minecraft:navigation.walk\": {\r\n\t\t\t\t\"is_amphibious\": true,\r\n\t\t\t\t\"avoid_sun\": true,\r\n\t\t\t\t\"avoid_water\": true\r\n\t\t\t},\r\n\t\t\t\"minecraft:movement.basic\": {},\r\n\t\t\t\"minecraft:jump.static\": {},\r\n\t\t\t\"minecraft:can_climb\": {},\r\n\t\t\t\"minecraft:scale\": {\r\n\t\t\t\t\"value\": 1\r\n\r\n\t\t\t},\r\n\t\t\t\"minecraft:fire_immune\": true,\r\n\t\t\t\"minecraft:behavior.hurt_by_target\": {\r\n\t\t\t\t\"priority\": 1\r\n\t\t\t},\r\n\t\t\t\"minecraft:behavior.nearest_attackable_target\": {\r\n\t\t\t\t\"priority\": 2,\r\n\t\t\t\t\"reselect_targets\": true,\r\n\t\t\t\t\"entity_types\": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\t\t\"test\": \"is_family\",\r\n\t\t\t\t\t\t\t\"subject\": \"other\",\r\n\t\t\t\t\t\t\t\"value\": \"none\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"max_dist\": 16\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\t\t\"test\": \"is_family\",\r\n\t\t\t\t\t\t\t\"subject\": \"other\",\r\n\t\t\t\t\t\t\t\"value\": \"none\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"max_dist\": 16\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"filters\": {\r\n\t\t\t\t\t\t\t\"all_of\": [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\"test\": \"is_family\",\r\n\t\t\t\t\t\t\t\t\t\"subject\": \"other\",\r\n\t\t\t\t\t\t\t\t\t\"value\": \"baby_turtle\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\"test\": \"in_water\",\r\n\t\t\t\t\t\t\t\t\t\"subject\": \"other\",\r\n\t\t\t\t\t\t\t\t\t\"operator\": \"!=\",\r\n\t\t\t\t\t\t\t\t\t\"value\": true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"max_dist\": 16\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\t\"must_see\": true\r\n\t\t\t},\r\n\t\t\t\"minecraft:behavior.melee_attack\": {\r\n\t\t\t\t\"priority\": 4,\r\n\t\t\t\t\"target_dist\": 1.2,\r\n\t\t\t\t\"speed_multiplier\": 1.25,\r\n\t\t\t\t\"track_target\": true\r\n\t\t\t},\r\n\t\t\t\"minecraft:behavior.random_stroll\": {\r\n\t\t\t\t\"priority\": 5,\r\n\t\t\t\t\"speed_multiplier\": 1\r\n\t\t\t},\r\n\t\t\t\"minecraft:behavior.look_at_player\": {\r\n\t\t\t\t\"priority\": 6,\r\n\t\t\t\t\"look_distance\": 8\r\n\t\t\t},\r\n\t\t\t\"minecraft:behavior.random_look_around\": {\r\n\t\t\t\t\"priority\": 6\r\n\t\t\t},\r\n\t\t\t\"minecraft:type_family\": {\r\n\t\t\t\t\"family\": [\r\n\t\t\t\t\t\"villager\",\r\n\t\t\t\t\t\"korean\",\r\n\t\t\t\t\t\"neutral\",\r\n\t\t\t\t\t\"mob\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"minecraft:physics\": {},\r\n\t\t\t\"minecraft:pushable\": {\r\n\t\t\t\t\"is_pushable\": true,\r\n\t\t\t\t\"is_pushable_by_piston\": true\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"events\": {\r\n\t\t\t\"minecraft:entity_spawned\": {}\r\n\t\t},\r\n\t\t\"component_groups\": {}\r\n\t}\r\n}\r\n", "entity": "{\r\n\t\"format_version\": \"1.10.0\",\r\n\t\"minecraft:client_entity\": {\r\n\t\t\"description\": {\r\n\t\t\t\"identifier\": \"myname:korean_man\",\r\n\t\t\t\"materials\": {\r\n\t\t\t\t\"default\": \"skeleton\"\r\n\t\t\t},\r\n\t\t\t\"textures\": {\r\n\t\t\t\t\"default\": \"textures/entity/korean_man\"\r\n\t\t\t},\r\n\t\t\t\"geometry\": {\r\n\t\t\t\t\"default\": \"geometry.korean_man\"\r\n\t\t\t},\r\n\t\t\t\"animations\": {\r\n\t\t\t\t\"walk\": \"animation.man_run\",\r\n\t\t\t\t\"idle\": \"animation.man_idle\",\r\n\t\t\t\t\"attack\": \"animation.man_attack\",\r\n\t\t\t\t\"walking\": \"controller.animation.soldier.walking\",\r\n\t\t\t\t\"general\": \"controller.animation.soldier.general\",\r\n\t\t\t\t\"attacking\": \"controller.animation.soldier.attacking\"\r\n\t\t\t},\r\n\t\t\t\"scripts\": {\r\n\t\t\t\t\"animate\": [\r\n\t\t\t\t\t\"walking\",\r\n\t\t\t\t\t\"general\",\r\n\t\t\t\t\t\"attacking\",\r\n\t\t\t\t\t\"look_at_target\"\r\n\t\t\t\t],\r\n\t\t\t\t\"pre_animation\": [\r\n\t\t\t\t\t\"variable.attack \\u003d Math.sin(variable.attack_time * 30.0);\"\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t\"spawn_egg\": {\r\n\t\t\t\t\"base_color\": \"#4b6529\",\r\n\t\t\t\t\"overlay_color\": \"#ff9e00\"\r\n\t\t\t},\r\n\t\t\t\"render_controllers\": [\r\n\t\t\t\t\"controller.render.skeleton\"\r\n\t\t\t],\r\n\t\t\t\"enable_attachables\": true\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"}};
  const DEFAULT_SPAWN_RULE_TEXT = "{\r\n  \"format_version\": \"1.8.0\",\r\n  \"minecraft:spawn_rules\": {\r\n    \"description\": {\r\n      \"identifier\": \"myname:chinese_militia\",\r\n      \"population_control\": \"monster\"\r\n    },\r\n    \"conditions\": [\r\n      {\r\n        \"minecraft:spawns_on_surface\": {},\r\n        \"minecraft:brightness_filter\": {\r\n          \"min\": 0,\r\n          \"max\": 15,\r\n          \"adjust_for_weather\": false\r\n        },\r\n        \"minecraft:difficulty_filter\": {\r\n          \"min\": \"easy\",\r\n          \"max\": \"hard\"\r\n        },\r\n        \"minecraft:weight\": {\r\n          \"default\": 5\r\n        },\r\n        \"minecraft:biome_filter\": {\r\n          \"test\": \"has_biome_tag\", \"operator\":\"==\", \"value\": \"chinese\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n";
  const CATEGORIES = ["soldier", "archer", "cavalry", "horse_archer", "crossbow", "elephant", "gunner", "citizen"];

  const ALLOWED_CATEGORIES = new Set(CATEGORIES);
  const REQUIRED_HEADERS = [
    "Category","ID","Family","Health","Damage","Attackable Targets, Family","Attackable Targets, Tag",
    "Texture Path","Geometry ID","Spawn Egg - Base Color","Spawn Egg - Overlay Color","Spawn Rule"
  ];

  // DOM
  const excelFile = document.getElementById('excelFile');
  const zipFile = document.getElementById('zipFile');
  const parseBtn = document.getElementById('parseBtn');
  const generateBtn = document.getElementById('generateBtn');
  const clearBtn = document.getElementById('clearBtn');
  const dotParsed = document.getElementById('dotParsed');
  const txtParsed = document.getElementById('txtParsed');
  const kpiUnits = document.getElementById('kpiUnits');
  const kpiErrors = document.getElementById('kpiErrors');
  const summaryBody = document.getElementById('summaryBody');

  const previewIndex = document.getElementById('previewIndex');
  const previewBtn = document.getElementById('previewBtn');
  const preBeh = document.getElementById('preBeh');
  const preEnt = document.getElementById('preEnt');
  const preSpawn = document.getElementById('preSpawn');

  // State
  let templates = null;           // {category: {behavior: obj, entity: obj}}
  let spawnRuleTemplate = null;   // obj
  let parsedRows = [];            // normalized rows with computed values + errors
  let hasParsed = false;

  function setParsedStatus(ok, msg) {
    dotParsed.classList.remove('ok','bad');
    dotParsed.classList.add(ok ? 'ok' : 'bad');
    txtParsed.textContent = msg;
  }

  function normalizeHeader(h) {
    return String(h || '').trim().replace(/\s+/g,' ');
  }

  function splitCsvList(v) {
    if (v === null || v === undefined) return [];
    const s = String(v).trim();
    if (!s) return [];
    return s.split(',').map(x => x.trim()).filter(Boolean);
  }

  function asNumber(v) {
    if (v === null || v === undefined || v === '') return null;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function idTail(identifier) {
    const s = String(identifier || '');
    const parts = s.split(':');
    return (parts.length === 2 ? parts[1] : s).trim();
  }

  function safeFilenameTail(identifier) {
    const tail = idTail(identifier).replace(/[^a-zA-Z0-9_\-\.]/g,'_');
    return tail || 'unit';
  }

  function argbToHex(argb) {
    if (!argb) return null;
    const s = String(argb).replace(/^0x/i,'').trim();
    if (!/^[0-9a-fA-F]{8}$/.test(s)) return null;
    return ('#' + s.substring(2)).toLowerCase(); // drop alpha
  }

  function parseJsonc(text) {
    let t = String(text || '').replace(/^\uFEFF/, '');
    t = t.replace(/^\s*\/\/.*$/gm, '');
    t = t.replace(/\/\*[\s\S]*?\*\//g, '');
    return JSON.parse(t);
  }

  function guessCellHexOrNull(cell) {
    try {
      const fill = cell.fill;
      if (fill && fill.fgColor && fill.fgColor.argb) {
        const hx = argbToHex(fill.fgColor.argb);
        if (hx) return hx;
      }
      if (fill && fill.bgColor && fill.bgColor.argb) {
        const hx = argbToHex(fill.bgColor.argb);
        if (hx) return hx;
      }
    } catch (_) {}

    const v = cell.value;
    if (typeof v === 'string' && /^#?[0-9a-fA-F]{6}$/.test(v.trim())) {
      const t = v.trim();
      return (t.startsWith('#') ? t : ('#' + t)).toLowerCase();
    }
    return null;
  }

  function deepFindAndUpdate(obj, predicate, updater) {
    if (Array.isArray(obj)) {
      for (const item of obj) deepFindAndUpdate(item, predicate, updater);
      return;
    }
    if (obj && typeof obj === 'object') {
      if (predicate(obj)) updater(obj);
      for (const k of Object.keys(obj)) deepFindAndUpdate(obj[k], predicate, updater);
    }
  }

  function buildAttackableEntityTypes(families, tags) {
    const out = [];
    for (const fam of families) {
      out.push({ filters: { test:"is_family", subject:"other", value: fam }, max_dist: 64 });
    }
    for (const tag of tags) {
      out.push({ filters: { test:"has_tag", subject:"other", value: tag }, max_dist: 64 });
    }
    return out;
  }

  function applyBehaviorEdits(templateObj, row) {
    const obj = structuredClone(templateObj);

    try { obj["minecraft:entity"]["description"]["identifier"] = row.id; } catch (_) {}

    deepFindAndUpdate(obj, o => o && o["minecraft:type_family"] && Array.isArray(o["minecraft:type_family"].family), o => {
      o["minecraft:type_family"].family = row.familyList;
    });

    deepFindAndUpdate(obj, o => o && o["minecraft:health"] && typeof o["minecraft:health"] === 'object', o => {
      if (row.health !== null) { o["minecraft:health"].value = row.health; o["minecraft:health"].max = row.health; }
    });

    deepFindAndUpdate(obj, o => o && o["minecraft:attack"] && typeof o["minecraft:attack"] === 'object' && ("damage" in o["minecraft:attack"]), o => {
      if (row.damage !== null) o["minecraft:attack"].damage = row.damage;
    });

    deepFindAndUpdate(obj, o => o && o["minecraft:damage_sensor"] && Array.isArray(o["minecraft:damage_sensor"].triggers), o => {
      for (const trig of o["minecraft:damage_sensor"].triggers) {
        if (trig && trig.deals_damage === false && trig.on_damage && trig.on_damage.filters &&
            trig.on_damage.filters.test === "is_family" && trig.on_damage.filters.subject === "other") {
          trig.on_damage.filters.value = row.primaryFamily;
          break;
        }
      }
    });

    deepFindAndUpdate(obj, o => o && o["minecraft:behavior.hurt_by_target"] &&
      o["minecraft:behavior.hurt_by_target"].entity_types &&
      o["minecraft:behavior.hurt_by_target"].entity_types.filters &&
      o["minecraft:behavior.hurt_by_target"].entity_types.filters.test === "is_family" &&
      o["minecraft:behavior.hurt_by_target"].entity_types.filters.subject === "other", o => {
        o["minecraft:behavior.hurt_by_target"].entity_types.filters.value = row.primaryFamily;
      });

    if (row.targetsFamily.length || row.targetsTag.length) {
      deepFindAndUpdate(obj, o => o && o["minecraft:behavior.nearest_attackable_target"] &&
        Array.isArray(o["minecraft:behavior.nearest_attackable_target"].entity_types), o => {
          o["minecraft:behavior.nearest_attackable_target"].entity_types =
            buildAttackableEntityTypes(row.targetsFamily, row.targetsTag);
        });
    }

    return obj;
  }

  function applyClientEntityEdits(templateObj, row) {
    const obj = structuredClone(templateObj);
    try {
      const d = obj["minecraft:client_entity"]["description"];
      d.identifier = row.id;
      if (row.texturePath) d.textures.default = row.texturePath;
      if (row.geometryId) d.geometry.default = row.geometryId;
      d.spawn_egg = d.spawn_egg || {};
      if (row.spawnEggBase) d.spawn_egg.base_color = row.spawnEggBase;
      if (row.spawnEggOverlay) d.spawn_egg.overlay_color = row.spawnEggOverlay;
    } catch (_) {}
    return obj;
  }

  function applySpawnRuleEdits(templateObj, row) {
    const obj = structuredClone(templateObj);
    try {
      obj["minecraft:spawn_rules"]["description"]["identifier"] = row.id;
      const conds = obj["minecraft:spawn_rules"]["conditions"];
      if (Array.isArray(conds) && conds.length) {
        const bf = conds[0]["minecraft:biome_filter"];
        if (bf && typeof bf === 'object' && row.spawnBiomeTag) bf.value = row.spawnBiomeTag;
      }
    } catch (_) {}
    return obj;
  }

  function validateAndNormalizeRow(raw, rowIndex) {
    const errors = [];
    const category = String(raw.category || '').trim();
    if (!ALLOWED_CATEGORIES.has(category)) errors.push("Invalid Category");

    const id = String(raw.id || '').trim();
    if (!id) errors.push("Missing ID");
    else if (!/^[a-z0-9_\-\.]+:[a-z0-9_\-\.]+$/i.test(id)) errors.push("ID should look like namespace:name");

    const familyList = splitCsvList(raw.family);
    if (!familyList.length) errors.push("Missing Family");
    const primaryFamily = familyList[0] || "";

    const health = asNumber(raw.health);
    if (health === null) errors.push("Invalid Health");
    const damage = asNumber(raw.damage);
    if (damage === null) errors.push("Invalid Damage");

    const targetsFamily = splitCsvList(raw.targetsFamily);
    const targetsTag = splitCsvList(raw.targetsTag);

    const texturePath = String(raw.texturePath || '').trim();
    if (!texturePath) errors.push("Missing Texture Path");
    const geometryId = String(raw.geometryId || '').trim();
    if (!geometryId) errors.push("Missing Geometry ID");

    const spawnEggBase = raw.spawnEggBase || null;
    const spawnEggOverlay = raw.spawnEggOverlay || null;
    if (!spawnEggBase) errors.push("Missing Spawn Egg Base Color (fill or hex)");
    if (!spawnEggOverlay) errors.push("Missing Spawn Egg Overlay Color (fill or hex)");

    const spawnBiomeTag = String(raw.spawnBiomeTag || '').trim();
    if (!spawnBiomeTag) errors.push("Missing Spawn Rule (biome tag)");

    return {
      rowIndex, category, id,
      nameTail: safeFilenameTail(id),
      familyList, primaryFamily,
      health, damage,
      targetsFamily, targetsTag,
      texturePath, geometryId,
      spawnEggBase, spawnEggOverlay,
      spawnBiomeTag, errors
    };
  }

  function renderSummary() {
    summaryBody.innerHTML = "";
    if (!parsedRows.length) {
      summaryBody.innerHTML = `<tr><td colspan="9" class="small">No parsed rows.</td></tr>`;
      return;
    }
    for (const r of parsedRows) {
      const err = r.errors.join("; ");
      const tf = r.targetsFamily.join(", ");
      const tt = r.targetsTag.join(", ");
      const targets = `${tf || "—"} / ${tt || "—"}`;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.rowIndex}</td>
        <td><code>${r.category}</code></td>
        <td><code>${r.id}</code></td>
        <td><code>${r.primaryFamily || "—"}</code></td>
        <td>${r.health ?? "—"}</td>
        <td>${r.damage ?? "—"}</td>
        <td><code>${targets}</code></td>
        <td><code>${r.spawnBiomeTag || "—"}</code></td>
        <td style="color:${err ? "var(--danger)" : "var(--ok)"}">${err || "OK"}</td>
      `;
      summaryBody.appendChild(tr);
    }
  }

  function updateKpis() {
    kpiUnits.textContent = String(parsedRows.length);
    const errCount = parsedRows.reduce((a,r)=>a+(r.errors.length?1:0),0);
    kpiErrors.textContent = String(errCount);
    generateBtn.disabled = !(hasParsed && errCount === 0);
  }

  function loadEmbeddedDefaults() {
    const t = {};
    for (const cat of ALLOWED_CATEGORIES) {
      t[cat] = {
        behavior: parseJsonc(DEFAULT_TEMPLATES_TEXT[cat].behavior),
        entity: parseJsonc(DEFAULT_TEMPLATES_TEXT[cat].entity),
      };
    }
    templates = t;
    spawnRuleTemplate = parseJsonc(DEFAULT_SPAWN_RULE_TEXT);
  }

  async function maybeLoadTemplatesFromZip(file) {
    if (!file) { loadEmbeddedDefaults(); return; }
    const buf = await file.arrayBuffer();
    const zip = await JSZip.loadAsync(buf);

    const newTemplates = {};
    for (const cat of ALLOWED_CATEGORIES) {
      const behPath = Object.keys(zip.files).find(p => p.startsWith(cat + "/") && p.endsWith(".behavior.json"));
      const entPath = Object.keys(zip.files).find(p => p.startsWith(cat + "/") && p.endsWith(".entity.json"));
      if (!behPath || !entPath) throw new Error(`Templates ZIP missing ${cat}/*.behavior.json or ${cat}/*.entity.json`);
      const behText = await zip.files[behPath].async("string");
      const entText = await zip.files[entPath].async("string");
      newTemplates[cat] = { behavior: parseJsonc(behText), entity: parseJsonc(entText) };
    }
    const sr = zip.files["spawn_rule.json"];
    if (!sr) throw new Error("Templates ZIP missing spawn_rule.json");
    spawnRuleTemplate = parseJsonc(await sr.async("string"));
    templates = newTemplates;
  }

  async function parseExcel(file) {
    const buf = await file.arrayBuffer();
    const wb = new ExcelJS.Workbook();
    await wb.xlsx.load(buf);
    const ws = wb.worksheets[0];
    if (!ws) throw new Error("No worksheet found.");

    const headerRow = ws.getRow(1);
    const headerMap = new Map();
    headerRow.eachCell((cell, colNumber) => {
      const h = normalizeHeader(cell.value);
      if (h) headerMap.set(h, colNumber);
    });

    const missing = [];
    for (const req of REQUIRED_HEADERS) {
      if (req === "Damage") {
        if (!headerMap.has("Damage") && !headerMap.has("Damage ")) missing.push("Damage ");
      } else if (!headerMap.has(req)) missing.push(req);
    }
    if (missing.length) throw new Error("Missing columns: " + missing.join(", "));

    const col = (name) => (name === "Damage" ? (headerMap.get("Damage") || headerMap.get("Damage ")) : headerMap.get(name));

    const out = [];
    for (let r = 2; r <= ws.rowCount; r++) {
      const row = ws.getRow(r);
      const catVal = String(row.getCell(col("Category")).value ?? "").trim();
      const idVal = String(row.getCell(col("ID")).value ?? "").trim();
      if (!catVal && !idVal) continue;

      const raw = {
        category: row.getCell(col("Category")).value,
        id: row.getCell(col("ID")).value,
        family: row.getCell(col("Family")).value,
        health: row.getCell(col("Health")).value,
        damage: row.getCell(col("Damage")).value,
        targetsFamily: row.getCell(col("Attackable Targets, Family")).value,
        targetsTag: row.getCell(col("Attackable Targets, Tag")).value,
        texturePath: row.getCell(col("Texture Path")).value,
        geometryId: row.getCell(col("Geometry ID")).value,
        spawnEggBase: guessCellHexOrNull(row.getCell(col("Spawn Egg - Base Color"))),
        spawnEggOverlay: guessCellHexOrNull(row.getCell(col("Spawn Egg - Overlay Color"))),
        spawnBiomeTag: row.getCell(col("Spawn Rule")).value
      };

      out.push(validateAndNormalizeRow(raw, r-1));
    }
    return out;
  }

  function previewRow(index1based) {
    const idx = index1based - 1;
    const row = parsedRows[idx];
    if (!row) { preBeh.textContent = preEnt.textContent = preSpawn.textContent = "No such row."; return; }
    if (row.errors.length) {
      const msg = "Row has errors:\n" + row.errors.join("\n");
      preBeh.textContent = preEnt.textContent = preSpawn.textContent = msg;
      return;
    }
    const t = templates[row.category];
    preBeh.textContent = JSON.stringify(applyBehaviorEdits(t.behavior, row), null, 2);
    preEnt.textContent = JSON.stringify(applyClientEntityEdits(t.entity, row), null, 2);
    preSpawn.textContent = JSON.stringify(applySpawnRuleEdits(spawnRuleTemplate, row), null, 2);
  }

  async function generateZip() {
    const zip = new JSZip();
    const folderBeh = zip.folder("behaviors");
    const folderEnt = zip.folder("entity_resource");
    const folderSpawn = zip.folder("spawn_rules");
    const reportLines = [];

    let okCount = 0;
    for (const row of parsedRows) {
      if (row.errors.length) {
        reportLines.push(`Row #${row.rowIndex} (${row.id || "NO_ID"}): SKIPPED — ${row.errors.join("; ")}`);
        continue;
      }
      const t = templates[row.category];
      folderBeh.file(`${row.nameTail}.behavior.json`, JSON.stringify(applyBehaviorEdits(t.behavior, row), null, 2));
      folderEnt.file(`${row.nameTail}.entity.json`, JSON.stringify(applyClientEntityEdits(t.entity, row), null, 2));
      folderSpawn.file(`${row.nameTail}.spawn_rule.json`, JSON.stringify(applySpawnRuleEdits(spawnRuleTemplate, row), null, 2));
      okCount++;
    }

    reportLines.unshift(`Unit Factory Build Report`);
    reportLines.unshift(`Generated: ${okCount} unit(s)`);
    reportLines.unshift(`Total rows parsed: ${parsedRows.length}`);
    reportLines.unshift(`Timestamp: ${new Date().toISOString()}`);
    zip.file("build_report.txt", reportLines.join("\n"));

    const blob = await zip.generateAsync({ type: "blob" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "unit_factory_output.zip";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  }

  function resetAll() {
    loadEmbeddedDefaults();
    parsedRows = [];
    hasParsed = false;
    setParsedStatus(false, "No sheet loaded");
    summaryBody.innerHTML = `<tr><td colspan="9" class="small">Upload and parse an Excel file to see a summary.</td></tr>`;
    kpiUnits.textContent = "0";
    kpiErrors.textContent = "0";
    parseBtn.disabled = true;
    generateBtn.disabled = true;
    preBeh.textContent = preEnt.textContent = preSpawn.textContent = "—";
  }

  // Wire up
  excelFile.addEventListener('change', () => { parseBtn.disabled = !excelFile.files?.[0]; });

  parseBtn.addEventListener('click', async () => {
    try {
      parseBtn.disabled = true;
      setParsedStatus(false, "Loading…");
      await maybeLoadTemplatesFromZip(zipFile.files?.[0] || null);
      parsedRows = await parseExcel(excelFile.files[0]);
      hasParsed = true;
      renderSummary();
      updateKpis();
      const errCount = parsedRows.reduce((a,r)=>a+(r.errors.length?1:0),0);
      setParsedStatus(errCount === 0, errCount ? `Parsed with errors (${errCount} row(s) need fixes)` : `Parsed OK (${parsedRows.length} unit(s))`);
      previewIndex.value = 1;
      previewRow(1);
    } catch (e) {
      hasParsed = false;
      parsedRows = [];
      renderSummary();
      updateKpis();
      setParsedStatus(false, "Error: " + (e?.message || String(e)));
    } finally {
      parseBtn.disabled = false;
    }
  });

  generateBtn.addEventListener('click', async () => { await generateZip(); });

  clearBtn.addEventListener('click', () => {
    excelFile.value = "";
    zipFile.value = "";
    resetAll();
  });

  previewBtn.addEventListener('click', () => {
    const idx = Number(previewIndex.value || 1);
    previewRow(idx);
  });

  resetAll();
</script>
</body>
</html>
